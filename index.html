<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PION mini</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --lime:#b7ff3b;
      --text:#111;
      --muted:#777;
      --line:#eaeaea;
      --bg:#fff;
      --chip:#f2f2f2;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Arial;background:var(--bg);color:var(--text)}
    .app{min-height:100vh;padding-bottom:74px}

    /* top bar */
    .topbar{
      background:var(--lime);
      padding:12px 12px 10px;
      display:grid;
      grid-template-columns: 90px 1fr 44px;
      align-items:center;
      position:sticky;top:0;z-index:10;
    }
    .btn-ghost{background:transparent;border:0;font-size:16px;color:#000}
    .center{text-align:center;line-height:1.1}
    .brand{font-weight:900;letter-spacing:1px}
    .sub{font-size:12px;opacity:.7}

    /* content */
    .content{padding:14px}
    .hidden{display:none}

    /* bottom nav */
    .bottomnav{
      position:fixed;left:0;right:0;bottom:0;
      background:#fff;border-top:1px solid var(--line);
      display:flex;justify-content:space-around;
      padding:10px 6px;
      z-index:20;
    }
    .tab{
      width:25%;
      text-align:center;
      text-decoration:none;
      color:#666;
      font-size:18px;
      display:flex;flex-direction:column;align-items:center;gap:4px;
      padding:4px 0;
      position:relative;
    }
    .tab span{font-size:12px}
    .tab.active{color:#000;font-weight:700}
    .badge-count{
      position:absolute;
      top:0px;
      right:26%;
      min-width:18px;
      height:18px;
      padding:0 6px;
      border-radius:999px;
      background:#000;
      color:#fff;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      transform:translate(8px,-6px);
    }
    .badge-count.hidden{display:none}

    /* catalog header */
    .headline{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:10px}
    .logo{font-size:34px;font-weight:900}

    /* chips */
    .chips{display:flex;gap:8px;overflow:auto;padding-bottom:6px}
    .chip{
      border:1px solid #222;background:#fff;border-radius:18px;
      padding:8px 12px;white-space:nowrap;flex:0 0 auto;
      font-size:14px;
    }
    .chip.small{border-color:#ddd;color:#666;padding:6px 10px}
    .chip.on{background:var(--lime);border-color:var(--lime)}

    /* product grid */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
    .card{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff}
    .imgwrap{position:relative;aspect-ratio:1/1;background:#eee}
    .badge{position:absolute;top:10px;left:10px;background:#dff2ff;color:#0a4a7a;padding:6px 10px;border-radius:14px;font-size:12px;font-weight:700}
    .carticon{
      position:absolute;right:10px;bottom:10px;
      width:34px;height:34px;
      background:rgba(0,0,0,.35);
      border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      color:#fff;
      cursor:pointer;
      user-select:none;
    }
    .imgph{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:34px;
      font-weight:900;
      color:#222;
      background:linear-gradient(135deg, #f7f7f7, #e8e8e8);
    }

    .cardbody{padding:10px 10px 12px}
    .title{font-weight:700;margin-bottom:8px}
    .bottom{display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:900}
    .qty{display:flex;align-items:center;gap:10px}
    .qty button{
      width:28px;height:28px;border-radius:50%;
      border:1px solid #ddd;background:#fff;
      font-size:18px;line-height:1;
      cursor:pointer;
    }
    .qty button:disabled{opacity:.35;cursor:default}

    /* cart */
    .cart-title{font-size:22px;font-weight:900;margin:6px 0 12px}
    .cart-list{display:flex;flex-direction:column;gap:10px}
    .cart-item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      background:#fff;
    }
    .cart-left{display:flex;flex-direction:column;gap:4px}
    .cart-name{font-weight:800}
    .cart-price{color:#666;font-size:14px}
    .cart-bottom{
      margin-top:14px;
      border-top:1px solid var(--line);
      padding-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .total{font-size:18px;font-weight:900}
    .clear{
      border:1px solid #ddd;
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
    }

    /* cart empty */
    .empty{min-height:60vh;display:flex;align-items:center;justify-content:center}
    .panel{width:min(420px,100%);background:#f6f6f6;border-radius:20px;padding:26px;text-align:center}
    .panel .icon{font-size:34px;margin-bottom:12px}
    .panel .h{font-size:22px;font-weight:900;margin-bottom:8px}
    .panel .p{color:#666;margin-bottom:18px}
    .cta{background:var(--lime);border:0;border-radius:18px;padding:14px 16px;font-weight:900;width:70%;cursor:pointer}

    /* profile */
    .row{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .avatar{width:52px;height:52px;border-radius:50%;overflow:hidden;background:#eee;display:flex;align-items:center;justify-content:center}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .name{font-size:22px;font-weight:800}
    .box{background:#f6f6f6;border-radius:14px;padding:16px;margin-bottom:14px}
    .box h3{margin:0 0 6px 0;font-size:16px}
    .muted{color:#777}
    .list{display:flex;flex-direction:column;gap:14px;margin:10px 0 26px}
    .item{font-size:18px}
    .bonus{text-align:center;margin-top:10px}
    .bonus h2{margin:0 0 10px 0;font-size:22px}
    .score{font-size:38px;font-weight:900;margin:6px 0}

    /* about */
    .about h1{margin:0 0 10px 0}
    .about p{color:#555;line-height:1.4}
    .bigq{font-weight:900;text-align:center;margin:22px 0 12px;font-size:20px}
    .tile{display:flex;gap:12px;align-items:center;background:#f6f6f6;border-radius:16px;padding:14px;margin-bottom:12px}
    .tile .ic{width:44px;height:44px;border-radius:12px;background:var(--lime);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:900}
    .tile .t{font-weight:800}
  </style>
</head>

<body>
<div class="app">

  <!-- top bar -->
  <div class="topbar">
    <button class="btn-ghost" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
    <div class="center">
      <div class="brand">PION</div>
      <div class="sub">–º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
    </div>
    <button class="btn-ghost" aria-label="menu">‚ãØ</button>
  </div>

  <div class="content">

    <!-- CATALOG -->
    <section id="page-catalog">
      <div class="headline">
        <div class="logo">PION</div>
      </div>

      <div class="chips" id="cats"></div>
      <div class="chips" style="margin-top:6px" id="tags"></div>

      <div class="grid" id="grid"></div>
    </section>

    <!-- CART -->
    <section id="page-cart" class="hidden">
      <div class="cart-title">–ö–æ—Ä–∑–∏–Ω–∞</div>

      <div id="cartEmpty" class="empty">
        <div class="panel">
          <div class="icon">üõçÔ∏è</div>
          <div class="h">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
          <div class="p">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥e, –∏ –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</div>
          <button class="cta" id="goCatalog">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
        </div>
      </div>

      <div id="cartFilled" class="hidden">
        <div class="cart-list" id="cartList"></div>

        <div class="cart-bottom">
          <div class="total" id="cartTotal">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
          <button class="clear" id="clearCart">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="page-profile" class="hidden">
      <div class="row">
        <div class="avatar" id="avatar">üôÇ</div>
        <div class="name" id="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
      </div>

      <div class="box">
        <h3>–ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑</h3>
        <div class="muted">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
      </div>

      <div class="list">
        <div class="item">üìç –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</div>
        <div class="item">üß≥ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</div>
        <div class="item">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
      </div>

      <div class="bonus">
        <h2>–ë–æ–Ω—É—Å–Ω—ã–µ –±–∞–ª–ª—ã</h2>
        <div class="score">500</div>
        <div class="muted">–±–∞–ª–ª–æ–≤</div>
        <div class="muted" style="margin-top:8px">–° –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 1% –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ –≤ –≤–∏–¥–µ –±–∞–ª–ª–æ–≤</div>
        <div class="muted" style="margin-top:8px">1 –±–∞–ª–ª = 1 —Ä—É–±–ª—å</div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="page-about" class="hidden about">
      <h1>–û –ø—Ä–æ–µ–∫—Ç–µ PION</h1>
      <p>–ü–æ–∫–∞ —Ç—É—Ç –∑–∞–≥–ª—É—à–∫–∞. –ü–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—à—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ —Å–µ—Ä–≤–∏—Å, –¥–æ—Å—Ç–∞–≤–∫—É –∏ –ø—Ä–æ—á–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —Ä–∞–¥–æ—Å—Ç–∏.</p>

      <div class="bigq">–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä?</div>

      <div class="tile"><div class="ic">üßæ</div><div><div class="t">–°–±–æ—Ä–∫–∞</div><div class="muted">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞</div></div></div>
      <div class="tile"><div class="ic">üì¶</div><div><div class="t">–£–ø–∞–∫–æ–≤–∫–∞</div><div class="muted">–ß—Ç–æ–±—ã –¥–æ–µ—Ö–∞–ª–æ –∂–∏–≤—ã–º</div></div></div>
      <div class="tile"><div class="ic">üè∑Ô∏è</div><div><div class="t">–ù–∞–ª–æ–≥</div><div class="muted">–î–∞, –æ–Ω –≤—Å—ë –µ—â—ë —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</div></div></div>
    </section>

  </div>

  <!-- bottom nav -->
  <nav class="bottomnav">
    <a href="#catalog" class="tab active" id="tab-catalog">‚ò∞<span>–ú–µ–Ω—é</span></a>
    <a href="#cart" class="tab" id="tab-cart">
      üõí<span>–ö–æ—Ä–∑–∏–Ω–∞</span>
      <div class="badge-count hidden" id="cartBadge">0</div>
    </a>
    <a href="#profile" class="tab" id="tab-profile">üë§<span>–ü—Ä–æ—Ñ–∏–ª—å</span></a>
    <a href="#about" class="tab" id="tab-about">‚ÑπÔ∏è<span>–û –ø—Ä–æ–µ–∫—Ç–µ</span></a>
  </nav>

</div>

<script>
  // Telegram
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }
  document.getElementById("closeBtn").onclick = () => tg?.close();

  // Profile: –∏–º—è (–∏ —Ñ–æ—Ç–æ –µ—Å–ª–∏ –µ—Å—Ç—å)
  const user = tg?.initDataUnsafe?.user;
  if (user) {
    document.getElementById("username").textContent =
      [user.first_name, user.last_name].filter(Boolean).join(" ");
    if (user.photo_url) {
      document.getElementById("avatar").innerHTML = `<img src="${user.photo_url}" alt="avatar">`;
    }
  }

  // Data: –∑–∞–≥–ª—É—à–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
  const CATEGORIES = ["–í—Å–µ","–¶–≤–µ—Ç—ã","–°–µ—Ç—ã","–≠–∫–∑–æ—Ç–∏–∫–∞"];
  const TAGS = ["–ë–µ–ª—ã–µ","–ö—Ä–∞—Å–Ω—ã–µ","–†–æ–∑–æ–≤—ã–µ","–ê—Ä–æ–º–∞—Ç–Ω—ã–µ","–°—Ç–æ–π–∫–∏–µ"];

  const PRODUCTS = Array.from({length: 8}).map((_, i) => ({
    id: "p" + (i + 1),
    title: "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ " + (i + 1),
    price: 1500 + i * 350,
    badge: "–î–æ—Å—Ç–∞–≤–∏–º –∑–∞–≤—Ç—Ä–∞",
    cat: i % 3 === 0 ? "–°–µ—Ç—ã" : (i % 3 === 1 ? "–¶–≤–µ—Ç—ã" : "–≠–∫–∑–æ—Ç–∏–∫–∞"),
    tags: i % 2 === 0 ? ["–†–æ–∑–æ–≤—ã–µ","–°—Ç–æ–π–∫–∏–µ"] : ["–ö—Ä–∞—Å–Ω—ã–µ","–ê—Ä–æ–º–∞—Ç–Ω—ã–µ"],
    ph: (i + 1) // –Ω–æ–º–µ—Ä –¥–ª—è –∑–∞–≥–ª—É—à–∫–∏ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ
  }));

  // Cart state (localStorage)
  const cart = JSON.parse(localStorage.getItem("cart") || "{}");
  const saveCart = () => localStorage.setItem("cart", JSON.stringify(cart));

  const $ = (id) => document.getElementById(id);

  // Navigation
  const pages = {
    catalog: $("page-catalog"),
    cart: $("page-cart"),
    profile: $("page-profile"),
    about: $("page-about")
  };
  const tabs = {
    catalog: $("tab-catalog"),
    cart: $("tab-cart"),
    profile: $("tab-profile"),
    about: $("tab-about")
  };

  function showPage(name){
    Object.keys(pages).forEach(k => pages[k].classList.toggle("hidden", k!==name));
    Object.keys(tabs).forEach(k => tabs[k].classList.toggle("active", k===name));
    location.hash = name;
  }

  // tab clicks
  Object.keys(tabs).forEach(key => {
    tabs[key].addEventListener("click", (e) => {
      e.preventDefault();
      showPage(key);
    });
  });

  $("goCatalog").onclick = () => showPage("catalog");

  // state for filters
  const state = { cat:"–í—Å–µ", tag:null };

  // helpers
  function qtyOf(id){ return cart[id] || 0; }
  function cartCount(){
    return Object.values(cart).reduce((a, b) => a + b, 0);
  }
  function cartTotal(){
    let sum = 0;
    for (const [id, qty] of Object.entries(cart)) {
      const p = PRODUCTS.find(x => x.id === id);
      if (p) sum += p.price * qty;
    }
    return sum;
  }

  function renderBadge(){
    const n = cartCount();
    $("cartBadge").textContent = String(n);
    $("cartBadge").classList.toggle("hidden", n === 0);
  }

  function renderChips() {
    $("cats").innerHTML = CATEGORIES.map(c =>
      `<button class="chip ${state.cat===c ? "on":""}" data-cat="${c}">${c}</button>`
    ).join("");

    $("tags").innerHTML = TAGS.map(t =>
      `<button class="chip small ${state.tag===t ? "on":""}" data-tag="${t}">${t}</button>`
    ).join("");

    $("cats").onclick = (e) => {
      const b = e.target.closest("button"); if(!b) return;
      state.cat = b.dataset.cat;
      render();
    };
    $("tags").onclick = (e) => {
      const b = e.target.closest("button"); if(!b) return;
      state.tag = (state.tag === b.dataset.tag) ? null : b.dataset.tag;
      render();
    };
  }

  function renderGrid() {
    const list = PRODUCTS.filter(p => {
      const okCat = state.cat === "–í—Å–µ" || p.cat === state.cat;
      const okTag = !state.tag || p.tags.includes(state.tag);
      return okCat && okTag;
    });

    $("grid").innerHTML = list.map(p => `
      <div class="card">
        <div class="imgwrap">
          <div class="badge">${p.badge}</div>
          <div class="imgph">${p.ph}</div>
          <div class="carticon" data-open-cart="1" title="–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">üõí</div>
        </div>
        <div class="cardbody">
          <div class="title">${p.title}</div>
          <div class="bottom">
            <div class="price">${p.price.toLocaleString("ru-RU")} ‚ÇΩ</div>
            <div class="qty">
              <button data-dec="${p.id}" ${qtyOf(p.id)===0 ? "disabled":""}>‚Äì</button>
              <span>${qtyOf(p.id)}</span>
              <button data-inc="${p.id}">+</button>
            </div>
          </div>
        </div>
      </div>
    `).join("");

    $("grid").onclick = (e) => {
      const btn = e.target.closest("button");
      const openCart = e.target.closest("[data-open-cart]");

      if (openCart) {
        showPage("cart");
        return;
      }

      if (!btn) return;
      const inc = btn.dataset.inc;
      const dec = btn.dataset.dec;

      if (inc) {
        cart[inc] = (cart[inc]||0) + 1;   // —Ç–æ–≤–∞—Ä "—É–ª–µ—Ç–∞–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É"
        saveCart();
        render();                         // –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏/–∫–æ—Ä–∑–∏–Ω—É/–∫–∞—Ä—Ç–æ—á–∫–∏
      }
      if (dec) {
        cart[dec] = (cart[dec]||0) - 1;
        if (cart[dec] <= 0) delete cart[dec];
        saveCart();
        render();
      }
    };
  }

  function renderCart() {
    const empty = Object.keys(cart).length === 0;
    $("cartEmpty").classList.toggle("hidden", !empty);
    $("cartFilled").classList.toggle("hidden", empty);

    if (empty) return;

    const items = Object.entries(cart).map(([id, qty]) => {
      const p = PRODUCTS.find(x => x.id === id);
      if (!p) return "";
      return `
        <div class="cart-item">
          <div class="cart-left">
            <div class="cart-name">${p.title}</div>
            <div class="cart-price">${p.price.toLocaleString("ru-RU")} ‚ÇΩ</div>
          </div>

          <div class="qty">
            <button data-dec="${p.id}">‚Äì</button>
            <span>${qty}</span>
            <button data-inc="${p.id}">+</button>
          </div>
        </div>
      `;
    }).join("");

    $("cartList").innerHTML = items;
    $("cartTotal").textContent = "–ò—Ç–æ–≥–æ: " + cartTotal().toLocaleString("ru-RU") + " ‚ÇΩ";

    // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ +/- –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ä–∑–∏–Ω—ã
    $("cartList").onclick = (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const inc = btn.dataset.inc;
      const dec = btn.dataset.dec;

      if (inc) {
        cart[inc] = (cart[inc]||0) + 1;
        saveCart();
        render();
      }
      if (dec) {
        cart[dec] = (cart[dec]||0) - 1;
        if (cart[dec] <= 0) delete cart[dec];
        saveCart();
        render();
      }
    };

    $("clearCart").onclick = () => {
      for (const k of Object.keys(cart)) delete cart[k];
      saveCart();
      render();
    };
  }

  function render(){
    renderChips();
    renderGrid();
    renderCart();
    renderBadge();
  }

  // initial page
  const start = (location.hash || "#catalog").replace("#","");
  showPage(["catalog","cart","profile","about"].includes(start) ? start : "catalog");
  render();
</script>
</body>
</html>
